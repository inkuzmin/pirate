// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o,u,a;if(window.top===window){t=function(){function t(){this.audios=new Array;this.ids=new Array;console.log("VKAudiocollection created")}t.prototype.collectNodes=function(){return document.getElementsByClassName("play_new")};t.prototype.parseNodes=function(){var t,n,r,i,s,o;this.nodes=this.collectNodes();s=this.nodes;o=[];for(r=0,i=s.length;r<i;r++){t=s[r];if(this.ids.indexOf(t.id)===-1){n=new e(t);this.ids.push(t.id);o.push(this.audios.push(n))}else o.push(void 0)}return o};t.prototype.showBitrates=function(){var e,t,n,r,i;r=this.audios;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(e.showBitrate())}return i};t.prototype.hideBitrates=function(){var e,t,n,r,i;r=this.audios;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(e.hideBitrate())}return i};return t}();e=function(){function e(e){this.node=e;console.log("VKAudio builded");this.id=this.node.id;this.getBitrate()}e.prototype.getBitrate=function(){var e,t,n,r,i;i=this.id.replace("play","audio_info");r=document.getElementById(i);e=r.value.match(/(https?:\/\/.+\.(?:vkontakte\.ru|vk\.com|userapi\.com|vk\.me)\/.*.mp3),([0-9]+)/i);n=e[1];t=e[2];return safari.self.tab.dispatchMessage("getBitrate",{url:n,duration:t,id:this.id})};e.prototype.setBitrate=function(e){this.bitrate=e};e.prototype.createLink=function(){return!0};e.prototype.createBitrateNode=function(){this.divNode=document.createElement("div");n(this.divNode,"vkaudioBitrate");this.divNode.innerHTML=this.bitrate;return s(this.node,this.divNode)};e.prototype.showBitrate=function(){var e,t=this;return e=setInterval(function(){var r,i,s,u;if(t.bitrate){r="";t.bitrate>315?r="green":250<(i=t.bitrate)&&i<=315?r="blue":120<(s=t.bitrate)&&s<=250?r="orange":60<(u=t.bitrate)&&u<=120?r="red":r="brown";t.divNode||t.createBitrateNode();o(t.divNode,"vkaudioHidden");n(t.divNode,"vkaudioShown");n(t.divNode,r);return clearInterval(e)}},100)};e.prototype.hideBitrate=function(){var e,t=this;return e=setInterval(function(){if(t.bitrate){o(t.divNode,"vkaudioShown");n(t.divNode,"vkaudioHidden");return clearInterval(e)}},100)};e.prototype.setLink=function(){};return e}();u=function(e){var t;t=e.name;switch(t){case"setBitrate":return a(e.message)}};a=function(e){var t;t=i.ids.indexOf(e.id);return i.audios[t].setBitrate(e.bitrate)};s=function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)};n=function(e,t){return e.className+=" "+t};o=function(e,t){return e.className=e.className.replace(t,"")};safari.self.addEventListener("message",u,!1);i=new t;r=!1;document.addEventListener("keydown",function(e){if(e.altKey){r=!0;i.parseNodes();return i.showBitrates()}},!1);document.addEventListener("keyup",function(e){if(r){i.hideBitrates();return r=!1}},!1)}}).call(this);